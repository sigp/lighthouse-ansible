---
- name: Creates a new testnet with new EC2 instances
  hosts:
    - localhost
  gather_facts: False
  roles:
    - aws
  vars_files:
    - ./secret.yml
  tasks:
    - name: Configure security groups
      include_tasks: roles/aws/tasks/ec2-security-groups.yml
    - name: Provision boot_node ec2 instances
      vars:
        role: "boot_node"
        instance_count: "{{ boot_node_per_region }}"
        instance_type: "{{ boot_node_instance_type }}"
        volume_gb: "{{ boot_node_volume_size_gb }}"
      include_tasks: roles/aws/tasks/ec2-provision.yml
    - name: Provision beacon_node ec2 instances
      vars:
        role: "beacon_node"
        instance_count: "{{ beacon_node_per_region }}"
        instance_type: "{{ beacon_node_instance_type }}"
        volume_gb: "{{ beacon_node_volume_size_gb }}"
      include_tasks: roles/aws/tasks/ec2-provision.yml
    - name: Provision validator ec2 instances
      vars:
        role: "validator"
        instance_count: "{{ validator_per_region }}"
        instance_type: "{{ validator_instance_type }}"
        volume_gb: "{{ validator_volume_size_gb }}"
      include_tasks: roles/aws/tasks/ec2-provision.yml
