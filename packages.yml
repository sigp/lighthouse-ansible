---
- name: Deploys packages and configuration to hosts
  hosts:
    - beacon_node
    - boot_node
  roles:
    - common
    - aws
    - geth
    - rust
    - lighthouse
  gather_facts:
      false
  vars_files:
    - ./secret.yml
  tasks:
    - name: Add keys to ssh/authorized_keys
      include_tasks: roles/aws/tasks/authorized-keys.yml
    - name: Build Geth from source
      include_tasks: roles/geth/tasks/build-from-source.yml
    - name: Provide initial eth1 wallet and ETH
      include_tasks: roles/geth/tasks/create-and-endow-wallet.yml
    - name: Configure systemd for Geth
      include_tasks: roles/geth/tasks/configure-systemd.yml
    - name: Start Geth service
      include_tasks: roles/geth/tasks/start.yml
    - name: Install Rust
      include_tasks: roles/rust/tasks/install.yml
    - name: Build lcli from source
      include_tasks: roles/lighthouse/tasks/build-lcli-from-source.yml
    - name: Build Lighthouse from source
      include_tasks: roles/lighthouse/tasks/build-from-source.yml
    - name: Configure systemd for Lighthouse
      include_tasks: roles/lighthouse/tasks/configure-systemd.yml
